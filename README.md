# my-pay

마이 페이는 무슨 일을 할까?
마이 페이 - 간편 결제 시스템 like 카카X 페이, 사과 페이 등...

비즈니스 능력을 기준으로, 고객 입장에서의 서비스(Micro Service X) 에서 마이 페이에 필요한 기능을 정의

- 회원 가입 및 정보 변경 기능
  - Membership Service! 이미 식별 완료!
- [회원 to 회원] [회원 to 일반 은행계좌] 간 간편 송금 기능
  - 일단 머니의 개념부터!!
- 가맹점에서의 결제 기능 + 가맹점 정산 기능

## 머니의 이해1 - 선불 충전 금액
James :   우리 와이프는 나에게 매월 20만원을 마이페이로 용돈을 주지! -> "**마이 머니**" 정의 해요
사용자가 마이 페이에 송금을 하면 "마이 페이 법인 계좌"에 송금이 된다. 그리고 나서 사용자 계좌에서 돈이 빠지고 
"마이 페이" SQL에 저장되어 마이 페이에 돈이 있다는것을  표현할 수 있다.
## 머니의 이해 2 - 펌뱅킹 !?
항상 10,000원씩 충전되던 이유
결제 시 10,000원 넘으면, 정확한 금액으로 충전되는 이유
송금 메뉴에 가면, 각 서비스마다 이체 가능한 은행 목록이 다른 이유
#### 펌뱅킹!
은행의 기능을 시스템적으로 이용하기 위한 수단이 시스템을 사용하는 회사 입장에서는 

개별적인 은행마다 별도의 계약을 맺고 수수료 지불

펌뱅킹 기능 사용마다 은행에 수수료를 지불해야만 해요.
- 은행 거래 즉 계좌 간 돈의 이동을 의미
- 입/출금 이행 요청 마다 고정금액 수수료 지불

## 송금시 어떤 일들이 일어날까? -> 돈을 보내는일

- [회원 to 회원]
  - 단순 선불 충전 금액(머니)의 이동 트랜잭션
    - 잔액 부족 시, 최소 10,000원 단위로 충전 후 이동

- [회원 to 일반 은행 계좌] 간 간편 송금 기능
  - 선불 충전 금액(머니)에서 타행의 실제 계좌로의 금액 이동
    - 마이 페이 법인 계좌의 이해가 필요해요.

### 마이 페이가 하는 일을 비즈니스 능력 기준으로 정의해 보자
비즈니스 능력을 기준으로, 고객 입장에서의 서비스(Micro Service X)에서 마이 페이에 필요한 기능을 정의

- 회원 가입 및 정보 변경 기능
  - Membership Service + [계좌 연결] 기능

- [회원 to 회원] / [회원 to 일반 은행 계좌] 간 간편 송금 기능
  - 회원 간 잔액 이동 비즈니스 로직
  - 외부 실제 은행 관리 시스템(모듈) - 뱅킹

- 가맹점에서의 결제 기능 + 정산 기능
  - 가맹점 관리 시스템 + 가맹점 계좌 등록
  - 결제 시스템 + 크론잡을 통한 정산 기능

--> 모놀리식 형태로 먼저 설계해보자
## 모놀리스 아키텍처에서의 멀티 모듈 마이 페이
- **회원 관리 시스템 (Membership)**
- **외부 은행 관리 - 펌뱅킹 시스템(Baking)**
- **머니 관리 시스템 (Money)**
- **가맹점 관리 시스템 (Franchise)**
- **결제 및 전표 생성 시스템 (Payment)**

**송금 ?**
- **단순 비즈니스 로직**
**정산 ?**
- **단순 Cron Job**

### 모놀리스 아키텍처에서의 멀티 모듈 마이 페이

SQL <-- Money, Franchise, Payment, Banking --> Real Bank
                                   ,Membership

## 결론
**앞으로의 계획**
간편 결제 시스템이 무엇인지 이해했어요.
Monolithic (One DB) 기준으로, 논리적인 아키텍처도 설계해 보았어요.

이렇게 설계해본 아키텍처를 MSA로 가기 위한 첫 단계인 분리/분해 부터 해보기 전에
분리 / 분해를 어떻게 하면 좋을지에 대한 이론 (비즈니스 능력 기반 / 하위 도메인 기반) 학습
분리 / 분해의 과정에서 기존의 모놀리식과 동시에 운영을 하기 위한 방안의 이론적 학습

하위 도메인 기반 분리 / 분해를 통한 MSA 마이 페이의 서비스 정의!

## 분해 = 비즈니스 능력(Business Capability)을 기준으로 서비스를 정의 하는일
왜 분해 / 통합이 어려울까?
MSA에서 분리 / 분해의 의미는
**"Business Capability를 가질수 있는 방향으로 서비스를 정의 하는 일"** -> 통합이 될 수도!

수 많은 복잡한 비즈니스가 있는 시스템에서 각 서비스가 Business Capbility를 
최대한 가질 수 있도록 적절하게 서비스를 정의하는 일

각 서비스별로 하나의 DB를(MSA) 가진다는 관점에서, 각 서비스 간 적절한 관계를 통해 Business Capability 확보하는 것이 관건!

**어떤 기준에 따라서? 어떤 지침에 따라서? 분리/분해/통합 하면 좋을지가 Business Capability를 가질 수 있을까??**
**--> 비즈니스 동작 / 하위 도메인 패턴이 그 수단이 되어 줄 수 있어요.** 
 하위 도메인(Sub-Domain) --> 도메인 주도 설계(Domain-Driven Design, DDD)에서 나온 개념!

주문 
- 주문 서비스 (고객 입장)
- 주문 접수
  - 주문을 "잘" 접수하는 것에 집중
    - 비동기 통신 파턴(큐잉) 등의 스택에 집중
- 주문 결제
  - 받은 주문에 대한 결제를 "잘"하는 것에 집중
    - 외부 결제 모듈의 통신 or 낮은 수수료를 위한 방안 찾는 데 집중
- 주문 단계에서의 추천
  - 주문 과정에서 "적절한" 방식으로 추가 상품 구매를 유도 집중 
    - AI/머신 러닝 활용으로 고객 별 최적화에 집중